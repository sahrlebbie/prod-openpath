[source::...tenable_vulnerability_summary_modalert.log*]
sourcetype = ta:tenable:log

[source::...launch_remediation_scan_modalert.log*]
sourcetype = ta:tenable:log

[tenable:sc:vuln]
FIELDALIAS-bugtraq = bid AS bugtraq
FIELDALIAS-category = family.name AS category
FIELDALIAS-cvss = cvssV3BaseScore AS cvss
EVAL-dest = if(isnotnull(dnsName), dnsName, ip)
FIELDALIAS-dest_ip = ip AS dest_ip
FIELDALIAS-dest_name = dnsName AS dest_name
FIELDALIAS-signature = synopsis AS signature
EVAL-vendor_product = "Tenable.sc"
EVAL-product = "Tenable.sc"
EVAL-vendor = "Tenable"
# Normalised
FIELDALIAS-cvss2_base_score = baseScore AS cvss2_base_score
FIELDALIAS-check_type = checkType AS check_type
FIELDALIAS-cvss3_base_score = cvssV3BaseScore AS cvss3_base_score
FIELDALIAS-cvss3_temporal_score = cvssV3TemporalScore AS cvss3_temporal_score
FIELDALIAS-cvss3_vector_raw = cvssV3Vector AS cvss3_vector_raw
FIELDALIAS-cvss2_vector_raw = cvssVector AS cvss2_vector_raw
FIELDALIAS-dns_name = dnsName AS dns_name
FIELDALIAS-exploit_available = exploitAvailable AS exploit_available
FIELDALIAS-exploitability_ease = exploitEase AS exploitability_ease
FIELDALIAS-exploit_frameworks = exploitFrameworks AS exploit_frameworks
FIELDALIAS-plugin_family_id = family.id AS plugin_family_id
FIELDALIAS-plugin_family = family.name AS plugin_family
FIELDALIAS-plugin_family_type = family.type AS plugin_family_type
FIELDALIAS-first_found = firstSeen AS first_found
FIELDALIAS-has_been_mitigated = hasBeenMitigated AS has_been_mitigated
EVAL-ipv4 = if(match(ip, "^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.|$)){4}"), ip, null())
EVAL-ipv6 = if(match(ip, "^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.|$)){4}"), null(), ip)
FIELDALIAS-last_found = lastSeen AS last_found
FIELDALIAS-patch_publish_date = patchPubDate AS patch_publish_date
FIELDALIAS-plugin_id = pluginID AS plugin_id
FIELDALIAS-plugin_info = pluginInfo AS plugin_info
FIELDALIAS-plugin_modification_date = pluginModDate AS plugin_modification_date
FIELDALIAS-plugin_name = pluginName AS plugin_name
FIELDALIAS-plugin_publication_date = pluginPubDate AS plugin_publication_date
FIELDALIAS-plugin_output = pluginText AS plugin_output
FIELDALIAS-repository_data_format = repository.dataFormat AS repository_data_format
FIELDALIAS-repository_description = repository.description AS repository_description
FIELDALIAS-repository_id = repository.id AS repository_id
FIELDALIAS-repository = repository.name AS repository
FIELDALIAS-risk_factor = riskFactor AS risk_factor
FIELDALIAS-see_also = seeAlso AS see_also
FIELDALIAS-stig_severity = stigSeverity AS stig_severity
FIELDALIAS-cvss_temporal_score = temporalScore AS cvss_temporal_score
FIELDALIAS-agent_uuid = uuid AS agent_uuid
FIELDALIAS-plugin_version = version AS plugin_version
FIELDALIAS-vuln_publication_date = vulnPubDate AS vuln_publication_date
FIELDALIAS-xrefs = xref AS xrefs

MAX_DAYS_AGO = 10951
MAX_TIMESTAMP_LOOKAHEAD = 1
SHOULD_LINEMERGE = 0
category = Tenable
pulldown_type = 1
TRUNCATE = 68000000
KV_MODE = JSON
DATETIME_CONFIG = NONE

[tenable:sc:mobile:vuln]
FIELDALIAS-bugtraq = bid AS bugtraq
FIELDALIAS-cvss = cvssV3BaseScore AS cvss
FIELDALIAS-signature = synopsis AS signature
EVAL-vendor_product = "Tenable.sc"
EVAL-product = "Tenable.sc"
EVAL-vendor = "Tenable"
# Normalised
FIELDALIAS-cvss2_base_score = baseScore AS cvss2_base_score
FIELDALIAS-check_type = checkType AS check_type
FIELDALIAS-cvss3_base_score = cvssV3BaseScore AS cvss3_base_score
FIELDALIAS-cvss3_temporal_score = cvssV3TemporalScore AS cvss3_temporal_score
FIELDALIAS-cvss3_vector_raw = cvssV3Vector AS cvss3_vector_raw
FIELDALIAS-cvss2_vector_raw = cvssVector AS cvss2_vector_raw
FIELDALIAS-device_version = deviceVersion AS device_version
FIELDALIAS-exploit_available = exploitAvailable AS exploit_available
FIELDALIAS-exploitability_ease = exploitEase AS exploitability_ease
FIELDALIAS-exploit_frameworks = exploitFrameworks AS exploit_frameworks
FIELDALIAS-last_found = lastSeen AS last_found
FIELDALIAS-mdm_type = mdmType AS mdm_type
FIELDALIAS-mdm_model = model AS mdm_model
FIELDALIAS-os_cpe = osCPE AS os_cpe
FIELDALIAS-patch_publish_date = patchPubDate AS patch_publish_date
FIELDALIAS-plugin_id = pluginID AS plugin_id
FIELDALIAS-plugin_info = pluginInfo AS plugin_info
FIELDALIAS-plugin_modification_date = pluginModDate AS plugin_modification_date
FIELDALIAS-plugin_name = pluginName AS plugin_name
FIELDALIAS-plugin_publication_date = pluginPubDate AS plugin_publication_date
FIELDALIAS-plugin_output = pluginOutput AS plugin_output
FIELDALIAS-repository_data_format = repository.dataFormat AS repository_data_format
FIELDALIAS-repository_description = repository.description AS repository_description
FIELDALIAS-repository_id = repository.id AS repository_id
FIELDALIAS-repository = repository.name AS repository
FIELDALIAS-risk_factor = riskFactor AS risk_factor
FIELDALIAS-see_also = seeAlso AS see_also
FIELDALIAS-stig_severity = stigSeverity AS stig_severity
FIELDALIAS-cvss_temporal_score = temporalScore AS cvss_temporal_score
FIELDALIAS-plugin_version = version AS plugin_version
FIELDALIAS-vuln_publication_date = vulnPubDate AS vuln_publication_date
FIELDALIAS-xrefs = xref AS xrefs

MAX_DAYS_AGO = 10951
MAX_TIMESTAMP_LOOKAHEAD = 1
SHOULD_LINEMERGE = 0
category = Tenable
pulldown_type = 1
TRUNCATE = 68000000
KV_MODE = JSON
DATETIME_CONFIG = NONE

[tenable:sc:plugin]
MAX_DAYS_AGO = 10951
MAX_TIMESTAMP_LOOKAHEAD = 1
SHOULD_LINEMERGE = 0
category = Tenable
pulldown_type = 1
TRUNCATE = 68000000
KV_MODE = JSON
DATETIME_CONFIG = NONE
# Normalised
FIELDALIAS-risk_factor = riskFactor AS risk_factor

[tenable:sc:assets]
# Normalised
FIELDALIAS-bios_uuid = biosGUID AS bios_uuid
FIELDALIAS-dns_name = dnsName AS dns_name
EVAL-ipv4 = if(match(ip, "^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.|$)){4}"), ip, null())
EVAL-ipv6 = if(match(ip, "^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.|$)){4}"), null(), ip)
FIELDALIAS-last_authenticated_scan_date = lastAuthRun AS last_authenticated_scan_date
FIELDALIAS-last_unauthenticated_scan_date = lastUnauthRun AS last_unauthenticated_scan_date
FIELDALIAS-mac_address = macAddress AS mac_address
FIELDALIAS-mcafee_epo_guid = mcafeeGUID AS mcafee_epo_guid
FIELDALIAS-netbios_name = netbiosName AS netbios_name
FIELDALIAS-os_cpe = osCPE AS os_cpe
FIELDALIAS-temp_id = tpmID AS temp_id
FIELDALIAS-agent_uuid = uuid AS agent_uuid
FIELDALIAS-repository_data_format = repository.dataFormat AS repository_data_format
FIELDALIAS-repository_description = repository.description AS repository_description
FIELDALIAS-repository_id = repository.id AS repository_id
FIELDALIAS-repository = repository.name AS repository

MAX_DAYS_AGO = 10951
MAX_TIMESTAMP_LOOKAHEAD = 1
SHOULD_LINEMERGE = 0
category = Tenable
pulldown_type = 1
TRUNCATE = 68000000
KV_MODE = JSON
DATETIME_CONFIG = NONE

[tenable:sc:mobile:assets]
# Normalised
FIELDALIAS-repository_data_format = repository.dataFormat AS repository_data_format
FIELDALIAS-repository_description = repository.description AS repository_description
FIELDALIAS-repository_id = repository.id AS repository_id
FIELDALIAS-repository = repository.name AS repository

MAX_DAYS_AGO = 10951
MAX_TIMESTAMP_LOOKAHEAD = 1
SHOULD_LINEMERGE = 0
category = Tenable
pulldown_type = 1
TRUNCATE = 68000000
KV_MODE = JSON
DATETIME_CONFIG = NONE

[tenable:sc:vuln:cert]
SHOULD_LINEMERGE = 0
category = Tenable
pulldown_type = 1

[tenable:io:vuln]
EVAL-dest = ipv4 AS dest
EVAL-vendor_product = "Tenable.io"
EVAL-product = "Tenable.io"
EVAL-vendor = "Tenable"
FIELDALIAS-bugtraq = plugin.bid{} AS bugtraq
FIELDALIAS-cvss = plugin.cvss3_base_score AS cvss
FIELDALIAS-dest-ip = ipv4 AS dest_ip
FIELDALIAS-category = plugin.family AS category
FIELDALIAS-signature = plugin.synopsis AS signature
FIELDALIAS-xref = plugin.xrefs{}.type AS xref
FIELDALIAS-ip = ipv4 AS ip
# Normalised
FIELDALIAS-dns_name = asset_fqdn AS dns_name
FIELDALIAS-cvss2_base_score = plugin.cvss_base_score AS cvss2_base_score
FIELDALIAS-bid = plugin.bid{} AS bid
FIELDALIAS-check_type = plugin.type AS check_type
FIELDALIAS-cpe = plugin.cpe{} AS cpe
FIELDALIAS-cve = plugin.cve{} AS cve
FIELDALIAS-cvss3_base_score = plugin.cvss3_base_score AS cvss3_base_score
FIELDALIAS-cvss3_temporal_score = plugin.cvss3_temporal_score AS cvss3_temporal_score
FIELDALIAS-description = plugin.description AS description
FIELDALIAS-exploit_available = plugin.exploit_available AS exploit_available
FIELDALIAS-exploitability_ease = plugin.exploitability_ease AS exploitability_ease
FIELDALIAS-plugin_family_id = plugin.family_id AS plugin_family_id
FIELDALIAS-plugin_family = plugin.family AS plugin_family
EVAL-last_found = if(state="fixed",last_fixed,last_found)
FIELDALIAS-plugin_id = plugin.id AS plugin_id
FIELDALIAS-plugin_modification_date = plugin.modification_date AS plugin_modification_date
FIELDALIAS-plugin_name = plugin.name AS plugin_name
FIELDALIAS-plugin_publication_date = plugin.publication_date AS plugin_publication_date
FIELDALIAS-plugin_output = output AS plugin_output
FIELDALIAS-port = port.port AS port
FIELDALIAS-protocol = port.protocol AS protocol
FIELDALIAS-risk_factor = plugin.risk_factor AS risk_factor
FIELDALIAS-see_also = plugin.see_also{} AS see_also
FIELDALIAS-solution = plugin.solution AS solution
FIELDALIAS-stig_severity = plugin.stig_severity AS stig_severity
FIELDALIAS-synopsis = plugin.synopsis AS synopsis
FIELDALIAS-cvss_temporal_score = plugin.cvss_temporal_score AS cvss_temporal_score
FIELDALIAS-plugin_version = plugin.version AS plugin_version
FIELDALIAS-vuln_publication_date = plugin.vuln_publication_date AS vuln_publication_date
EVAL-xrefs = mvjoin(mvzip('plugin.xrefs{}.type', 'plugin.xrefs{}.id', " #"), ",")
FIELDALIAS-cvss3_temporal_vector_exploitability = plugin.cvss3_temporal_vector.exploitability AS cvss3_temporal_vector_exploitability
FIELDALIAS-cvss3_temporal_vector_remediation_level = plugin.cvss3_temporal_vector.remediation_level AS cvss3_temporal_vector_remediation_level
FIELDALIAS-cvss3_temporal_vector_report_confidence = plugin.cvss3_temporal_vector.report_confidence AS cvss3_temporal_vector_report_confidence
FIELDALIAS-cvss3_vector_access_complexity = plugin.cvss3_vector.access_complexity AS cvss3_vector_access_complexity
FIELDALIAS-cvss3_vector_access_vector = plugin.cvss3_vector.access_vector AS cvss3_vector_access_vector
FIELDALIAS-cvss3_vector_authentication = plugin.cvss3_vector.authentication AS cvss3_vector_authentication
FIELDALIAS-cvss3_vector_availability_impact = plugin.cvss3_vector.availability_impact AS cvss3_vector_availability_impact
FIELDALIAS-cvss3_vector_confidentiality_impact = plugin.cvss3_vector.confidentiality_impact AS cvss3_vector_confidentiality_impact
FIELDALIAS-cvss3_vector_integrity_impact = plugin.cvss3_vector.integrity_impact AS cvss3_vector_integrity_impact
FIELDALIAS-cvss2_temporal_vector_exploitability = plugin.cvss_temporal_vector.exploitability AS cvss2_temporal_vector_exploitability
FIELDALIAS-cvss2_temporal_vector_remediation_level = plugin.cvss_temporal_vector.remediation_level AS cvss2_temporal_vector_remediation_level
FIELDALIAS-cvss2_temporal_vector_report_confidence = plugin.cvss_temporal_vector.report_confidence AS cvss2_temporal_vector_report_confidence
FIELDALIAS-cvss2_vector_access_complexity = plugin.cvss_vector.access_complexity AS cvss2_vector_access_complexity
FIELDALIAS-cvss2_vector_access_vector = plugin.cvss_vector.access_vector AS cvss2_vector_access_vector
FIELDALIAS-cvss2_vector_authentication = plugin.cvss_vector.authentication AS cvss2_vector_authentication
FIELDALIAS-cvss2_vector_availability_impact = plugin.cvss_vector.availability_impact AS cvss2_vector_availability_impact
FIELDALIAS-cvss2_vector_confidentiality_impact = plugin.cvss_vector.confidentiality_impact AS cvss2_vector_confidentiality_impact
FIELDALIAS-cvss2_vector_integrity_impact = plugin.cvss_vector.integrity_impact AS cvss2_vector_integrity_impact
FIELDALIAS-d2_elliot_name = plugin.d2_elliot_name AS d2_elliot_name
FIELDALIAS-exploit_framework_canvas = plugin.exploit_framework_canvas AS exploit_framework_canvas
FIELDALIAS-exploit_framework_core = plugin.exploit_framework_core AS exploit_framework_core
FIELDALIAS-exploit_framework_d2_elliot = plugin.exploit_framework_d2_elliot AS exploit_framework_d2_elliot
FIELDALIAS-exploit_framework_exploithub = plugin.exploit_framework_exploithub AS exploit_framework_exploithub
FIELDALIAS-exploit_framework_metasploit = plugin.exploit_framework_metasploit AS exploit_framework_metasploit
FIELDALIAS-exploited_by_malware = plugin.exploited_by_malware AS exploited_by_malware
FIELDALIAS-exploited_by_nessus = plugin.exploited_by_nessus AS exploited_by_nessus
FIELDALIAS-exploithub_sku = plugin.exploithub_sku AS exploithub_sku
FIELDALIAS-has_patch = plugin.has_patch AS has_patch
FIELDALIAS-in_the_news = plugin.in_the_news AS in_the_news
FIELDALIAS-metasploit_name = plugin.metasploit_name AS metasploit_name
FIELDALIAS-ms_bulletin = plugin.ms_bulletin{} AS ms_bulletin
FIELDALIAS-patch_publication_date = plugin.patch_publication_date AS patch_publication_date
FIELDALIAS-unsupported_by_vendor = plugin.unsupported_by_vendor AS unsupported_by_vendor
FIELDALIAS-usn = plugin.usn AS usn
FIELDALIAS-service = port.service AS service
FIELDALIAS-canvas_package = plugin.canvas_package AS canvas_package
FIELDALIAS-checks_for_default_account = plugin.checks_for_default_account AS checks_for_default_account
FIELDALIAS-checks_for_malware = plugin.checks_for_malware AS checks_for_malware

MAX_DAYS_AGO = 10951
MAX_TIMESTAMP_LOOKAHEAD = 1
SHOULD_LINEMERGE = 0
category = Tenable
pulldown_type = 1
TRUNCATE = 68000000
KV_MODE = JSON
DATETIME_CONFIG = NONE

[tenable:io:assets]
# Normalised
FIELDALIAS-dns_name = network_interfaces{}.fqdns{} AS dns_name
FIELDALIAS-ipv4 = network_interfaces{}.ipv4s{} AS ipv4
FIELDALIAS-ipv6 = network_interfaces{}.ipv6s{} AS ipv6
FIELDALIAS-mac_address = network_interfaces{}.mac_addresses{} AS mac_address
FIELDALIAS-netbios_name = netbios_names{} AS netbios_name
FIELDALIAS-asset_uuid = uuid AS asset_uuid
FIELDALIAS-agent_names = agent_names{} AS agent_names
FIELDALIAS-mac_addresses = mac_addresses{} AS mac_addresses
FIELDALIAS-netbios_names = netbios_names{} AS netbios_names
FIELDALIAS-operating_systems = operating_systems{} AS operating_systems
FIELDALIAS-system_types = system_types{} AS system_types
FIELDALIAS-hostnames = hostnames{} AS hostnames
FIELDALIAS-ssh_fingerprints = ssh_fingerprints{} AS ssh_fingerprints
FIELDALIAS-qualys_asset_ids = qualys_asset_ids{} AS qualys_asset_ids
FIELDALIAS-qualys_host_ids = qualys_host_ids{} AS qualys_host_ids
FIELDALIAS-fqdns = fqdns{} AS fqdns
FIELDALIAS-manufacturer_tpm_ids = manufacturer_tpm_ids{} AS manufacturer_tpm_ids
FIELDALIAS-symantec_ep_hardware_keys = symantec_ep_hardware_keys{} AS symantec_ep_hardware_keys
FIELDALIAS-ipv4s = ipv4s{} AS ipv4s
FIELDALIAS-ipv6s = ipv6s{} AS ipv6s

MAX_DAYS_AGO = 10951
MAX_TIMESTAMP_LOOKAHEAD = 1
SHOULD_LINEMERGE = 0
category = Tenable
pulldown_type = 1
TRUNCATE = 68000000
KV_MODE = JSON
DATETIME_CONFIG = NONE

[tenable:io:plugin]
MAX_DAYS_AGO = 10951
MAX_TIMESTAMP_LOOKAHEAD = 1
SHOULD_LINEMERGE = 0
category = Tenable
pulldown_type = 1
TRUNCATE = 68000000
KV_MODE = JSON
DATETIME_CONFIG = NONE

[source::tenable:eventgen]
DATETIME_CONFIG = /etc/datetime.xml

[source::...ta-tenable*.log*]
sourcetype = ta:tenable:log

[source::udp:*]
TRANSFORMS-changesourcetype = set_sourcetype_nnm, set_sourcetype_pvs

[source::tcp:*]
TRANSFORMS-changesourcetype = set_sourcetype_nnm, set_sourcetype_pvs

[tenable:nnm:vuln]
DATETIME_CONFIG = CURRENT
EVAL-vendor_product = "Tenable NNM"
EVAL-product = "NNM"
EVAL-vendor = "Tenable"
TRUNCATE = 68000000
SHOULD_LINEMERGE = 0

#Extract Statement 
EXTRACT-nnm_type,src,src_port,dest,dest_port,protocol,plugin_id,plugin_name,plugin_description,plugin_output,risk = (?P<nnm_type>nnm|pvs):\s(?P<src>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}):(?P<src_port>\d{1,5})\|(?P<dest>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}):(?P<dest_port>\d{1,5})\|(?P<protocol>\d{1,3})\|(?P<plugin_id>\d{1,5})\|(?P<plugin_name>[^|]+)\|(?P<plugin_description>[^\|]+)\|(?P<plugin_output>.*)?\|(?P<risk>[^\|]+)

# Fieldalias
FIELDALIAS-src = src AS src_ip
FIELDALIAS-dest = dest AS dest_ip
EVAL-severity = case(risk="NONE","none",risk="INFO","informational",risk="LOW","low",risk="MEDIUM","medium",risk="HIGH","high",risk="CRITICAL","critical")

# Lookups
LOOKUP-proto = protocol_lookup protocol OUTPUT protocol_name
LOOKUP-srcport = port_lookup port AS src_port OUTPUT service AS src_svc
LOOKUP-destport = port_lookup port AS dest_port OUTPUT service AS dest_svc

[stash_common_action_model]
TRUNCATE                = 0
# only look for ***SPLUNK*** on the first line
HEADER_MODE             = firstline
# we can summary index past data, but rarely future data
MAX_DAYS_HENCE          = 2
MAX_DAYS_AGO            = 10000
# 5 years difference between two events
MAX_DIFF_SECS_AGO       = 155520000
MAX_DIFF_SECS_HENCE     = 155520000
TIME_PREFIX             = (?m)^\*{3}Common\sAction\sModel\*{3}.*$
MAX_TIMESTAMP_LOOKAHEAD = 25
LEARN_MODEL             = false
# break .stash_new custom format into events
SHOULD_LINEMERGE        = false
BREAK_ONLY_BEFORE_DATE  = false
LINE_BREAKER            = (\r?\n==##~~##~~  1E8N3D4E6V5E7N2T9 ~~##~~##==\r?\n)

TRANSFORMS-0parse_cam_header    = orig_action_name_for_stash_cam,orig_sid_for_stash_cam,orig_rid_for_stash_cam,sourcetype_for_stash_cam
TRANSFORMS-1sinkhole_cam_header = sinkhole_cam_header